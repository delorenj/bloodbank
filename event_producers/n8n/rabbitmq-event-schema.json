{
  "schema_version": "1.0.0",
  "event_name": "fireflies.transcript.ready",
  "description": "Durable event published when Fireflies transcription is completed and ready for ingestion",

  "exchange": {
    "name": "fireflies.events",
    "type": "topic",
    "durable": true,
    "autoDelete": false,
    "arguments": {}
  },

  "routing_keys": {
    "transcript_ready": "fireflies.transcript.completed",
    "pattern": "fireflies.transcript.*"
  },

  "payload_schema": {
    "meetingId": {
      "type": "string",
      "required": true,
      "description": "Unique identifier for the Fireflies meeting/transcription",
      "example": "01K78EDVB8F67J0SMJE31331NC"
    },
    "eventType": {
      "type": "string",
      "required": true,
      "description": "Type of event from Fireflies",
      "example": "Transcription completed"
    },
    "transcriptUrl": {
      "type": "string",
      "required": true,
      "description": "URL to access the full transcript JSON or text",
      "example": "https://fireflies.ai/view/01K78EDVB8F67J0SMJE31331NC"
    },
    "transcript": {
      "type": "object",
      "required": false,
      "description": "Full transcript object if available from Fireflies API",
      "properties": {
        "title": "string",
        "date": "string (ISO 8601)",
        "duration": "number (seconds)",
        "participants": "array of strings",
        "sentences": "array of transcript segments",
        "summary": "string"
      }
    },
    "metadata": {
      "type": "object",
      "required": true,
      "properties": {
        "timestamp": {
          "type": "string",
          "format": "ISO 8601",
          "description": "When the event was published"
        },
        "source": {
          "type": "string",
          "default": "n8n-fireflies-workflow",
          "description": "Source system publishing the event"
        },
        "version": {
          "type": "string",
          "default": "1.0.0",
          "description": "Event schema version"
        },
        "workflowId": {
          "type": "string",
          "description": "n8n workflow ID that published the event"
        },
        "executionId": {
          "type": "string",
          "description": "n8n execution ID for traceability"
        }
      }
    }
  },

  "queue_configuration": {
    "rag_ingestion_queue": {
      "name": "transcripts.rag.ingestion",
      "durable": true,
      "exclusive": false,
      "autoDelete": false,
      "arguments": {
        "x-message-ttl": 86400000,
        "x-dead-letter-exchange": "fireflies.events.dlx",
        "x-dead-letter-routing-key": "transcript.failed"
      },
      "binding": {
        "exchange": "fireflies.events",
        "routing_key": "fireflies.transcript.completed"
      }
    }
  },

  "dead_letter_configuration": {
    "exchange": {
      "name": "fireflies.events.dlx",
      "type": "topic",
      "durable": true,
      "autoDelete": false
    },
    "queue": {
      "name": "transcripts.failed",
      "durable": true,
      "exclusive": false,
      "autoDelete": false,
      "arguments": {
        "x-message-ttl": 604800000
      }
    }
  },

  "consumer_configuration": {
    "prefetch_count": 1,
    "ack_mode": "manual",
    "retry_policy": {
      "max_retries": 3,
      "retry_delay_ms": 5000,
      "exponential_backoff": true
    }
  }
}
